!function (e, t) { if ("object" == typeof exports && "object" == typeof module) module.exports = t(); else if ("function" == typeof define && define.amd) define([], t); else { var u = t(); for (var n in u) ("object" == typeof exports ? exports : e)[n] = u[n] } }(window, function () { return function (e) { var t = {}; function u(n) { if (t[n]) return t[n].exports; var i = t[n] = { i: n, l: !1, exports: {} }; return e[n].call(i.exports, i, i.exports, u), i.l = !0, i.exports } return u.m = e, u.c = t, u.d = function (e, t, n) { u.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: n }) }, u.r = function (e) { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(e, "__esModule", { value: !0 }) }, u.t = function (e, t) { if (1 & t && (e = u(e)), 8 & t) return e; if (4 & t && "object" == typeof e && e && e.__esModule) return e; var n = Object.create(null); if (u.r(n), Object.defineProperty(n, "default", { enumerable: !0, value: e }), 2 & t && "string" != typeof e) for (var i in e) u.d(n, i, function (t) { return e[t] }.bind(null, i)); return n }, u.n = function (e) { var t = e && e.__esModule ? function () { return e.default } : function () { return e }; return u.d(t, "a", t), t }, u.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, u.p = "", u(u.s = 0) }([function (e, t, u) { var n = {}, i = u(1); !function () { var e = Array.prototype, t = Object.prototype, u = e.slice, i = t.hasOwnProperty, o = e.forEach, s = {}; n.uuid = function () { function e() { return Math.floor(65536 * (1 + Math.random())).toString(16).substring(1) } return e() + e() + "-" + e() + "-" + e() + "-" + e() + "-" + e() + e() + e() }, n.each = function (e, t, u) { if (null != e) if (o && e.forEach === o) e.forEach(t, u); else if (e.length === +e.length) { for (var n = 0, r = e.length; n < r; n++)if (n in e && t.call(u, e[n], n, e) === s) return } else for (var m in e) if (i.call(e, m) && t.call(u, e[m], m, e) === s) return }, n.extend = function (e) { return n.each(u.call(arguments, 1), function (t) { for (var u in t) void 0 !== t[u] && (e[u] = t[u]) }), e }, n.isUndefined = function (e) { return void 0 === e }, n.isString = function (e) { return "[object String]" == Object.prototype.toString.call(e) }, n.isArray = function (e) { return "[object Array]" === Object.prototype.toString.call(e) }, n.isFunction = function (e) { try { return /^\s*\bfunction\b/.test(e) } catch (e) { return !1 } }, n.isObject = function (e) { return e === Object(e) && !n.isArray(e) }, n.getSystemInfo = function () { var e = wx.getSystemInfoSync(); return e.resolution = e.windowWidth + "x" + e.windowHeight, e }, n.encode = function (e) { var t = {}; for (var u in e) t["_" + u] = e[u]; return t }, n.getNet = function (e) { wx.getNetworkType({ complete: function (t) { var u = "wifi" === t.networkType ? 1 : 0, n = "wifi" === t.networkType ? 0 : { "2g": 1, "3g": 3, "4g": 13 }[t.networkType]; r.set("net", u), r.set("mnet", n), e && e({ net: u, mnet: n }) } }) } }(); var r = { key: "zg", get: function (e) { var t = this.getAll(); return t ? t[e] : null }, set: function (e, t) { var u = this.getAll(); u[e] = t, wx.setStorageSync(this.key, u) }, setUtm: function (e) { wx.setStorageSync("utm", e) }, getUtm: function () { return wx.getStorageSync("utm") }, del: function (e) { var t = this.getAll(); delete t[e], wx.setStorageSync(this.key, t) }, getAll: function () { var e = wx.getStorageSync(this.key); return e || (e = { cache: [], ec: 0, net: 0, mnet: 0 }, wx.setStorageSync(this.key, e)), e }, clear: function () { var e = wx.getStorageSync(this.key); e.cache = [], e.ec = 0, wx.setStorageSync(this.key, e) }, getDid: function () { return wx.getStorageSync("zg-did") }, registerDid: function (e) { wx.setStorageSync("zg-did", e || n.uuid()) }, updateSession: function (e, t, u) { if (!e) return; let n = wx.getStorageSync("zg-session"); n ? (n.sid = e, n.active = t) : n = { sid: e, active: t }, console.log(u + "set session info is " + JSON.stringify(n)), wx.setStorageSync("zg-session", n) }, getSessionInfo: function () { return wx.getStorageSync("zg-session") }, flush: function (e) { for (var t = this.get("sid"), u = e || this.get("cache"), n = 0, i = u.length; n < i; n++) { var r = u[n]; r.pr.hasOwnProperty("$sid") || (r.pr.$sid = t) } return this.set("cache", []), u } }, o = function () { this._props = { appKey: "", br: "wx-app", an: "", vn: "", cn: "" }, this._url = { normal: "https://u.zhugeapi.net/web_event", bac: "https://ubak.zhugeio.com/web_event" }, this._urlOrigin = { normal: this._url.normal.replace("/web_event", ""), bac: this._url.bac.replace("/web_event", "") }, this._config = { debug: !1, did: "", an: "wxApp", vn: "1.0", pv: !1, wxeid: "" }, this._sdk = "web", this._sdkv = "2.4.2" }; o.prototype._registerOnce = function () { r.getDid() || r.registerDid(this._config.did) }, o.prototype._sendRequest = function (e) { var t = r.get("cache"); if (!r.get("sid") || !r.get("appKey")) return t.push(e), void r.set("cache", t); var u = new Date, n = { method: "web_event_srv.upload", event: { sln: "itn", pl: "js", sdk: "zg-js", sdkv: this._sdkv, owner: "zg", ut: [u.getFullYear(), u.getMonth() + 1, u.getDate()].join("-") + " " + u.toTimeString().match(/\d{2}:\d{2}:\d{2}/)[0], tz: 6e4 * -u.getTimezoneOffset(), debug: this._config.debug ? 1 : 0, ak: this._props.appKey, usr: { did: r.getDid() }, data: [] }, _: (new Date).getTime().toString() }; if (t.length) { let e = r.flush(t); n.event.data = n.event.data.concat(e) } n.event.data.push(e), this._request(n) }, o.prototype._request = function (e) { var t = this; wx.request({ url: this._url.normal, data: e, responseType: "arraybuffer", fail: function (u) { t._url.normal.toUpperCase() === t._url.bac.toUpperCase() || wx.request({ url: t._url.bac, data: e, responseType: "arraybuffer" }) } }) }, o.prototype._info = function () { var e = n.getSystemInfo(), t = new Date, u = { dt: "pl", pr: { $rs: e.resolution, $tz: 6e4 * -t.getTimezoneOffset(), $ct: t.getTime(), $cuid: r.get("cuid") } }; this._sendRequest(u) }, o.prototype._sessionStart = function () { var e = new Date, t = e.getTime(), u = n.getSystemInfo(), i = this; r.set("sid", t), r.updateSession(t, t, "会话开始"), n.getNet(function (o) { var s = { dt: "ss", pr: { $ct: e.getTime(), $sid: t, $cuid: r.get("cuid"), $cn: i._props.cn, $tz: 6e4 * -e.getTimezoneOffset(), $url: r.get("$url"), $os: u.system.split(/\s/)[0], $ov: u.system.split(/\s/)[1], $wv: u.version, $mnet: o.mnet, $net: o.net, $vn: i._props.vn, $referrer_domain: "miniprogram", $wxeid: i._config.wxeid } }; s.pr = n.extend(s.pr, r.getUtm()), i._sendRequest(s) }) }, o.prototype._sessionEnd = function () { var e = r.get("sid"), t = new Date, u = t.getTime() - e, i = { dt: "se", pr: { $ct: t.getTime(), $cn: this._props.cn, $tz: 6e4 * -t.getTimezoneOffset(), $dru: u, $sid: e, $cuid: r.get("cuid"), $referrer_domain: "miniprogram" } }; i.pr = n.extend(i.pr, r.getUtm()), this._sendRequest(i), r.clear() }, o.prototype._init = function () { this._registerOnce(), this._sessionStart(), this._info() }, o.prototype.weixinIdentify = function () { var e = this._config.wxeid; arguments[0] && "string" == typeof arguments[0] && (e = arguments[0]); var t = this._urlOrigin.normal, u = "", n = "", i = "", r = "", o = "", s = "", m = ""; let c = [function (e) { wx.login({ success: t => { u = t.code, e && e() }, fail: function (e) { console.log("诸葛SDK提示：", "登录失败", e) } }) }, function (e) { wx.getSetting({ success: t => { t.authSetting["scope.userInfo"] ? wx.getUserInfo({ lang: "zh_CN", success: t => { o = t.userInfo, s = t.iv, m = t.encryptedData, e && e() } }) : console.log("诸葛SDK提示：", "未授权", t) } }) }, function (o) { var s = this, m = { url: t + "/zgwx/user/code2session", method: "GET", data: { code: u, appId: e }, success: e => { n = e.data.openid, i = e.data.unionid, r = e.data.session_key, o && o() }, fail: function (e) { t !== s._urlOrigin.bac ? (t = s._urlOrigin.bac, wx.request(m)) : console.log("诸葛SDK提示：", "获取codeSession失败", e) } }; wx.request(m) }, function (e) { var u = this, n = { url: t + "/zgwx/data/decrypt", method: "POST", data: { sessionKey: r, iv: s, encryptData: m }, success: function (t) { i = t.data.unionId, e && e(t.data || {}) }, fail: function (e) { t !== u._urlOrigin.bac ? (t = u._urlOrigin.bac, wx.request(n)) : console.log("诸葛SDK提示：", "获取codeSession失败", e) } }; wx.request(n) }, function (e) { let t = ""; switch (o.gender) { case 1: t = "男"; break; case 2: t = "女" }this.identify(i || n, { name: o.nickName, avatar: o.avatarUrl, "微信-昵称": o.nickName, "微信-性别": t, "微信-城市": o.city, "微信-省": o.province, "微信-国家": o.country }), e && e() }], a = Array.prototype.pop.call(arguments); "function" == typeof a && c.push(function () { a({ userInfo: o, unionid: i, openid: n, sessionKey: r }) }), function e(t, u, n) { t.length <= n || t[n = n || 0].call(u, function () { e(t, u, n + 1) }) }(c, this) }, o.prototype.load = function (e, t) { if (this._props.appKey = e, r.set("appKey", e), n.isObject(t) && (this._config = n.extend(this._config, t), this._config.an && (this._props.an = this._config.an), this._config.vn && (this._props.vn = this._config.vn)), wx.getAccountInfoSync) { let e = wx.getAccountInfoSync(); e && e.miniProgram && e.miniProgram.appId && (this._config.wxeid = e.miniProgram.appId) } }, o.prototype.identify = function (e, t) { if (e && 0 != e.length) { var u = r.get("sid"), i = new Date; r.set("cuid", e); var o = { dt: "usr", pr: { $ct: i.getTime(), $tz: 6e4 * -i.getTimezoneOffset(), $cuid: e, $sid: u, $url: r.get("$url") } }; n.isObject(t) && (o.pr = n.extend(o.pr, n.encode(t))), this._sendRequest(o) } else console.error("identify uid不能为空") }, o.prototype.track = function (e, t) { e && e.length > 0 ? this.privateTrack(e, t, !0) : console.error("track 事件名称不能为空") }, o.prototype.privateTrack = function (e, t, u) { var i = r.get("sid"), o = new Date, s = n.getSystemInfo(), m = u ? "evt" : "abp", c = this; u && r.set("ec", r.get("ec") + 1), u && r.updateSession(i, o.getTime(), "标记事件" + m), n.getNet(function (a) { var d = { dt: m, pr: { $eid: e, $ct: o.getTime(), $tz: 6e4 * -o.getTimezoneOffset(), $cuid: r.get("cuid"), $cn: c._props.cn, $sid: i, $url: r.get("$url"), $os: s.system.split(/\s/)[0], $ov: s.system.split(/\s/)[1], $wv: s.version, $mnet: a.mnet + "", $referrer_domain: "miniprogram", $net: a.net + "", $vn: c._props.vn, $wxeid: c._config.wxeid } }; if (d.pr = n.extend(d.pr, r.getUtm()), n.isObject(t) && (d.pr = u ? n.extend(d.pr, n.encode(t)) : n.extend(d.pr, t)), i) c._sendRequest(d); else { let e = r.get("cache"); e.push(d), r.set("cache", e) } }) }, o.prototype.start = function () { this._init() }, o.prototype.end = function () { this._sessionEnd() }; var s = new o; function m(e, t, u) { if (e[t]) { var n = e[t]; e[t] = function () { n.apply(this, arguments), u.apply(this, arguments) } } else e[t] = u } function c(e, t) { var u = e || {}, n = t || {}; return ["utm_source", "utm_medium", "utm_campaign", "utm_content", "utm_term"].forEach(function (e) { u[e] ? n["$" + e] = u[e] : u["$" + e] && (n["$" + e] = u["$" + e]) }), n } var a = function () { }, d = function (e) { let t = function (e) { if (!e || !e.scene) return console.log("scene is null "), null; let t = e.scene, u = t.toString(); s._props.cn = u; let n, r, o = i[u]; i.isShare(t) && (r = e.referrerInfo.appId), o && (n = { utm_source: o.utm_source, utm_medium: o.utm_medium, utm_campaign: r }); let m = c(n); return c(e.query, m) }(e), u = t || {}, n = r.getSessionInfo(); if (n && n.hasOwnProperty("active")) { let e = (new Date).getTime(); e - n.active > 3e4 ? (r.setUtm(u), s.end(), s.start()) : (t && r.setUtm(t), r.set("sid", n.sid), r.updateSession(n.sid, e, "进入应用")) } else r.setUtm(u), s.start() }, _ = function () { let e = r.get("sid"), t = (new Date).getTime(); r.updateSession(e, t, "应用退出") }, f = App; App = function (e) { m(e, "onLaunch", a), m(e, "onShow", d), m(e, "onHide", _), f(e) }; var p = function (e) { let t = e || {}, u = Object.keys(t), n = this.__route__, i = this.__route__, o = []; if (u && u.length > 0) { n += "?"; for (let t = 0; t < u.length; t++) { let n = u[t]; o[t] = n + "=" + e[n] } n += o.join("&") } if (r.set("$url", n), !s._config.pv) return; let m = { $page_title: i }; s.privateTrack("pv", m, !1) }, g = function () { let e = r.get("sid"), t = new Date; r.updateSession(e, t.getTime(), "pageShow") }, l = function () { }, h = Page; Page = function (e) { m(e, "onLoad", p), m(e, "onShow", g), m(e, "onHide", l), h(e) }, App.zhuge = s, e.exports = s }, function (e, t) { e.exports = { 1044: { utm_source: "分享", utm_medium: "带shareTicket的小程序消息卡片（详情）" }, 1007: { utm_source: "分享", utm_medium: "单人聊天会话中的小程序消息卡片" }, 1008: { utm_source: "分享", utm_medium: "群聊会话中的小程序消息卡片" }, 1036: { utm_source: "分享", utm_medium: "App分享消息卡片" }, 1020: { utm_source: "公众号", utm_medium: "公众号profile页相关小程序列表" }, 1035: { utm_source: "公众号", utm_medium: "公众号自定义菜单" }, 1043: { utm_source: "公众号", utm_medium: "公众号模板消息" }, 1058: { utm_source: "公众号", utm_medium: "公众号文章" }, 1074: { utm_source: "公众号会话", utm_medium: "公众号会话下发的小程序消息卡片" }, 1067: { utm_source: "广告", utm_medium: "公众号文章广告" }, 1068: { utm_source: "广告", utm_medium: "附近小程序列表广告" }, 1073: { utm_source: "客服消息", utm_medium: "客服消息列表下发的小程序消息卡片" }, 1011: { utm_source: "扫码", utm_medium: "扫描二维码" }, 1012: { utm_source: "扫码", utm_medium: "长按图片识别二维码" }, 1013: { utm_source: "扫码", utm_medium: "手机相册选取二维码" }, 1025: { utm_source: "扫码", utm_medium: "扫描一维码" }, 1031: { utm_source: "扫码", utm_medium: "长按图片识别一维码" }, 1032: { utm_source: "扫码", utm_medium: "手机相册选取一维码" }, 1047: { utm_source: "扫码", utm_medium: "扫描小程序码" }, 1048: { utm_source: "扫码", utm_medium: "长按图片识别小程序码" }, 1049: { utm_source: "扫码", utm_medium: "手机相册选取小程序码" }, 1027: { utm_source: "搜索", utm_medium: "顶部搜索框搜索结果页“使用过的小程序”列表" }, 1005: { utm_source: "搜索", utm_medium: "顶部搜索框的搜索结果页" }, 1006: { utm_source: "搜索", utm_medium: "发现栏小程序主入口搜索框的搜索结果页" }, 1042: { utm_source: "搜索", utm_medium: "添加好友搜索框的搜索结果页" }, 1053: { utm_source: "搜索", utm_medium: "搜一搜的结果页" }, 1054: { utm_source: "搜索", utm_medium: "顶部搜索框小程序快捷入口" }, 1064: { utm_source: "微信WIFI", utm_medium: "微信连Wi-Fi状态栏" }, 1078: { utm_source: "微信WIFI", utm_medium: "连Wi-Fi成功页" }, 1028: { utm_source: "微信卡券", utm_medium: "我的卡包" }, 1029: { utm_source: "微信卡券", utm_medium: "卡券详情页" }, 1052: { utm_source: "微信卡券", utm_medium: "卡券的适用门店列表" }, 1019: { utm_source: "微信支付", utm_medium: "微信钱包" }, 1034: { utm_source: "微信支付", utm_medium: "微信支付完成页" }, 1057: { utm_source: "微信支付", utm_medium: "钱包中的银行卡详情页" }, 1071: { utm_source: "微信支付", utm_medium: "钱包中的银行卡列表页" }, 1072: { utm_source: "微信支付", utm_medium: "二维码收款页面" }, 1001: { utm_source: "微信主程序", utm_medium: "发现栏小程序主入口" }, 1022: { utm_source: "微信主程序", utm_medium: "聊天顶部置顶小程序入口" }, 1024: { utm_source: "微信主程序", utm_medium: "小程序 profile 页" }, 1089: { utm_source: "微信主程序", utm_medium: "微信聊天主界面下拉" }, 1026: { utm_source: "微信主程序", utm_medium: "附近小程序列表" }, 1037: { utm_source: "小程序", utm_medium: "小程序打开小程序" }, 1038: { utm_source: "小程序", utm_medium: "从另一个小程序返回" }, 1090: { utm_source: "小程序", utm_medium: "长按小程序右上角菜单唤出最近使用历史" }, 1014: { utm_source: "小程序模板消息", utm_medium: "小程序模板消息" }, 1039: { utm_source: "摇电视", utm_medium: "摇电视" }, 1056: { utm_source: "音乐播放器菜单", utm_medium: "音乐播放器菜单" }, 1023: { utm_source: "桌面图标", utm_medium: "安卓系统桌面图标" }, 1017: { utm_source: "体验版", utm_medium: "前往体验版的入口页" }, 1030: { utm_source: "测试", utm_medium: "自动化测试下打开小程序" }, 1059: { utm_source: "体验版", utm_medium: "体验版小程序绑定邀请页" }, 1092: { utm_source: "微信城市服务", utm_medium: "城市服务入口" }, 1091: { utm_source: "公众号", utm_medium: "公众号文章商品卡片" }, 1095: { utm_source: "广告", utm_medium: "小程序广告组件" }, 1096: { utm_source: "分享", utm_medium: "聊天记录" }, 1097: { utm_source: "微信支付", utm_medium: "微信支付签约页" }, 1099: { utm_source: "小程序", utm_medium: "页面内嵌插件" }, 1102: { utm_source: "公众号", utm_medium: "公众号profile页服务预览" }, 1081: { utm_source: "客服消息", utm_medium: "客服消息下发的文字链" }, 1082: { utm_source: "公众号", utm_medium: "公众号会话下发的文字链" }, 1084: { utm_source: "朋友圈", utm_medium: "朋友圈广告原生页" }, 1077: { utm_source: "摇周边", utm_medium: "摇周边" }, 1069: { utm_source: "移动应用", utm_medium: "移动应用" }, 1045: { utm_source: "朋友圈", utm_medium: "朋友圈广告" }, 1046: { utm_source: "朋友圈", utm_medium: "朋友圈广告详情页" }, 1079: { utm_source: "微信游戏中心", utm_medium: "微信游戏中心" }, isShare: function (e) { return -1 !== [1020, 1035, 1036, 1037, 1038, 1043].indexOf(e) } } }]) });